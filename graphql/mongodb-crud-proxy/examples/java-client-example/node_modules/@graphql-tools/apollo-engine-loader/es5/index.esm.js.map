{"version":3,"file":"index.esm.js","sources":["../../../dist-es5/loaders/apollo-engine/src/index.js"],"sourcesContent":["import { __assign, __awaiter, __generator } from \"tslib\";\nimport { fetch } from 'cross-fetch';\nimport { buildClientSchema } from 'graphql';\nvar DEFAULT_APOLLO_ENDPOINT = 'https://engine-graphql.apollographql.com/api/graphql';\n/**\n * This loader loads a schema from Apollo Engine\n */\nvar ApolloEngineLoader = /** @class */ (function () {\n    function ApolloEngineLoader() {\n    }\n    ApolloEngineLoader.prototype.loaderId = function () {\n        return 'apollo-engine';\n    };\n    ApolloEngineLoader.prototype.canLoad = function (ptr) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, typeof ptr === 'string' && ptr === 'apollo-engine'];\n            });\n        });\n    };\n    ApolloEngineLoader.prototype.canLoadSync = function () {\n        return false;\n    };\n    ApolloEngineLoader.prototype.load = function (_, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var response, _a, data, errors;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, fetch(options.engine.endpoint || DEFAULT_APOLLO_ENDPOINT, {\n                            method: 'POST',\n                            headers: __assign({ 'x-api-key': options.engine.apiKey, 'apollo-client-name': 'Apollo Language Server', 'apollo-client-reference-id': '146d29c0-912c-46d3-b686-920e52586be6', 'apollo-client-version': '2.6.8', 'Content-Type': 'application/json', Accept: 'application/json' }, options.headers),\n                            body: JSON.stringify({\n                                query: SCHEMA_QUERY,\n                                variables: {\n                                    id: options.graph,\n                                    tag: options.variant,\n                                },\n                            }),\n                        })];\n                    case 1:\n                        response = _b.sent();\n                        return [4 /*yield*/, response.json()];\n                    case 2:\n                        _a = _b.sent(), data = _a.data, errors = _a.errors;\n                        if (errors) {\n                            throw new Error(errors.map(function (_a) {\n                                var message = _a.message;\n                                return message;\n                            }).join('\\n'));\n                        }\n                        return [2 /*return*/, {\n                                location: 'apollo-engine',\n                                schema: buildClientSchema(data.service.schema),\n                            }];\n                }\n            });\n        });\n    };\n    ApolloEngineLoader.prototype.loadSync = function () {\n        throw new Error('Loader ApolloEngine has no sync mode');\n    };\n    return ApolloEngineLoader;\n}());\nexport { ApolloEngineLoader };\n/**\n * @internal\n */\nexport var SCHEMA_QUERY = /* GraphQL */ \"\\n  query GetSchemaByTag($tag: String!, $id: ID!) {\\n    service(id: $id) {\\n      ... on Service {\\n        __typename\\n        schema(tag: $tag) {\\n          hash\\n          __schema: introspection {\\n            queryType {\\n              name\\n            }\\n            mutationType {\\n              name\\n            }\\n            subscriptionType {\\n              name\\n            }\\n            types(filter: { includeBuiltInTypes: true }) {\\n              ...IntrospectionFullType\\n            }\\n            directives {\\n              name\\n              description\\n              locations\\n              args {\\n                ...IntrospectionInputValue\\n              }\\n            }\\n          }\\n        }\\n      }\\n    }\\n  }\\n\\n  fragment IntrospectionFullType on IntrospectionType {\\n    kind\\n    name\\n    description\\n    fields {\\n      name\\n      description\\n      args {\\n        ...IntrospectionInputValue\\n      }\\n      type {\\n        ...IntrospectionTypeRef\\n      }\\n      isDeprecated\\n      deprecationReason\\n    }\\n    inputFields {\\n      ...IntrospectionInputValue\\n    }\\n    interfaces {\\n      ...IntrospectionTypeRef\\n    }\\n    enumValues(includeDeprecated: true) {\\n      name\\n      description\\n      isDeprecated\\n      deprecationReason\\n    }\\n    possibleTypes {\\n      ...IntrospectionTypeRef\\n    }\\n  }\\n\\n  fragment IntrospectionInputValue on IntrospectionInputValue {\\n    name\\n    description\\n    type {\\n      ...IntrospectionTypeRef\\n    }\\n    defaultValue\\n  }\\n\\n  fragment IntrospectionTypeRef on IntrospectionType {\\n    kind\\n    name\\n    ofType {\\n      kind\\n      name\\n      ofType {\\n        kind\\n        name\\n        ofType {\\n          kind\\n          name\\n          ofType {\\n            kind\\n            name\\n            ofType {\\n              kind\\n              name\\n              ofType {\\n                kind\\n                name\\n                ofType {\\n                  kind\\n                  name\\n                }\\n              }\\n            }\\n          }\\n        }\\n      }\\n    }\\n  }\\n\";\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":"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"}